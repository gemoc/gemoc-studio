<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <title>4.2.&nbsp;Define DSE</title><link rel="stylesheet" href="css/docbook.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="GuideTutorialMarkedGraph.html" title="Tutorial"><link rel="up" href="ch04.html" title="Chapter&nbsp;4.&nbsp;Define the Execution Semantics"><link rel="prev" href="ch04.html" title="Chapter&nbsp;4.&nbsp;Define the Execution Semantics"><link rel="next" href="ch05.html" title="Chapter&nbsp;5.&nbsp;Execute a Model"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.2.&nbsp;Define DSE</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;4.&nbsp;Define the Execution Semantics</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch05.html">Next</a></td></tr></table><hr></div><div class="section" title="4.2.&nbsp;Define DSE"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_define_dse"></a>4.2.&nbsp;Define DSE</h2></div></div></div><p>The purpose of the DSE project is to define events (called DSE) on AS
elements that will trigger EF calls when they occurs.  Furthermore,
constraints can be defined on these events to define when they may occur.</p><div class="section" title="4.2.1.&nbsp;Create the DSE Project"><div class="titlepage"><div><div><h3 class="title"><a name="_create_the_dse_project"></a>4.2.1.&nbsp;Create the DSE Project</h3></div></div></div><p>Like for the DSA Project, right click on any file of the xDSML project and
choose <span class="emphasis"><em>GEMOC Languge &gt; Create DSE Project for language</em></span> to start the wizard.</p><div class="figure"><a name="d0e374"></a><div class="figure-contents"><div class="mediaobject"><img src="./MarkedGraph/images/v2.1/MG-XDSML-19b-dse-new.png" width="800" alt="Create a DSE Project"></div></div><p class="title"><b>Figure&nbsp;4.6.&nbsp;Create a DSE Project</b></p></div><br class="figure-break"><p>Then :</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Select the MarkedGraphL language and click <span class="emphasis"><em>OK</em></span>.</li><li class="listitem">On the next screen of the wizard, click <span class="emphasis"><em>Next</em></span> (the project name is already initialized <span class="emphasis"><em>org.gemoc.sample.markedgraph.dse</em></span>).</li><li class="listitem"><p class="simpara">On the last screen, complete the required fields:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">The MarkedGraph Ecore file has already been initialized, just click on <span class="emphasis"><em>Browse</em></span>.</li><li class="listitem">Select the root container : MarkedGraph::MarkedGraph</li><li class="listitem">Set the <span class="emphasis"><em>New ECL file basename</em></span> is already set to 'MarkedGraphL'</li></ul></div></li></ol></div><div class="figure"><a name="d0e420"></a><div class="figure-contents"><div class="mediaobject"><img src="./MarkedGraph/images/v2.1/MG-XDSML-24b-dse-wizard-completed.png" width="800" alt="Initializing the DSE project"></div></div><p class="title"><b>Figure&nbsp;4.7.&nbsp;Initializing the DSE project</b></p></div><br class="figure-break"><p>Once the wizard has been completed, the <span class="emphasis"><em>org.gemoc.sample.markedgraph.dse</em></span>
project is created with a template for the MarkedGraphL.ecl file (found in the
ecl directory).</p><div class="figure"><a name="d0e434"></a><div class="figure-contents"><div class="mediaobject"><img src="./MarkedGraph/images/v2.1/MG-XDSML-25-dse-template.png" width="800" alt="Template of the ECL file"></div></div><p class="title"><b>Figure&nbsp;4.8.&nbsp;Template of the ECL file</b></p></div><br class="figure-break"></div><div class="section" title="4.2.2.&nbsp;Define DSE"><div class="titlepage"><div><div><h3 class="title"><a name="_define_dse_2"></a>4.2.2.&nbsp;Define DSE</h3></div></div></div><p>Replace the content of the ECL file with the
<a class="link" href="MarkedGraph/MarkedGraphL.ecl" target="_top">following code</a> (explanations on
this code are given bellow):</p><p title="The file MarkedGraphL.ecl"><b>The file MarkedGraphL.ecl.&nbsp;</b>
</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> 'platform:/resource/org.gemoc.sample.markedgraph.model/model/markedgraph.ecore'

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">ECLimport</b> <i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/kernel.ccslLib"</i>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">ECLimport</b> <i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/CCSL.ccslLib"</i>

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> markedgraph

	<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">context</b> MarkedGraph
		<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b>: initIt: <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Event</b> = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.initialize()

	<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">context</b> Transition
		<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b>: fireIt: <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Event</b> = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.fire()

	<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">context</b> Place
		<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">inv</b> tokenCountIsNull:
			(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.tokenCount = 0) <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">implies</b>
				(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Relation</b> Precedes(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.input.fireIt, <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.output.fireIt))
		<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">inv</b> tokenCountIsNotNullDelayRequired:
			(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.tokenCount &gt; 0) <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">implies</b>
				<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">let</b> delay: <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Integer</b> = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.tokenCount <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">in</b>
				<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">let</b> outputDelayed: <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Event</b> =
					<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Expression</b> DelayFor(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.output.fireIt, <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.output.fireIt, delay) <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">in</b>
						<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Relation</b> Precedes(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.input.fireIt, outputDelayed)

	<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">context</b> MarkedGraph
        <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">inv</b> initFirst:
                <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">let</b> firstInit : <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Event</b> = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Expression</b> OneTickAndNoMore(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.initIt) <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">in</b>
                <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">let</b> allFire : <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Event</b> = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Expression</b> Union(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.transitions.fireIt) <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">in</b>
                <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">let</b> firstOfAllFire : <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Event</b> = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Expression</b> OneTickAndNoMore(allFire) <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">in</b>
                <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Relation</b> Precedes(firstInit, firstOfAllFire)

        <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">inv</b> onlyOneInit:
                <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">let</b> firstInit2 : <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Event</b> = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Expression</b> OneTickAndNoMore(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.initIt) <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">in</b>
                <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">Relation</b> Coincides(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">self</b>.initIt, firstInit2)

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">endpackage</b></pre><p title="The file MarkedGraphL.ecl">
</p><div class="figure"><a name="d0e459"></a><div class="figure-contents"><div class="mediaobject"><img src="./MarkedGraph/images/v2.1/MG-XDSML-26-dse-completed.png" width="800" alt="Definition of the DSE (events and constraints)"></div></div><p class="title"><b>Figure&nbsp;4.9.&nbsp;Definition of the DSE (events and constraints)</b></p></div><br class="figure-break"><p>This step has three main purposes:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">First, it specifies DSE in the context of metaclasses of the AS.
For Marked Graph xDSML, we identify 2 DSE:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">fireIt: defined in the context of a Transition</li><li class="listitem">initIt: defined in the context of a MarkedGraph</li></ul></div></li><li class="listitem"><p class="simpara">Then, it links them to EF from DSA --- when a DSE will occur the
associated EF will be executed.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">fireIt is linked to the EF 'fire' of Transition</li><li class="listitem">initIt is linked to the EF 'initialize' of MarkedGraph</li></ul></div></li><li class="listitem"><p class="simpara">Finally, it defines constraints on the DSE to rule the possible
scheduling.  Constraints generally rely on relations which are defined
in MoCC libraries. Here constraints are expressed in CCSL and only relies
on relations and expression from the CCSL core library.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">A first constraint applies on the fireIt events.  It is depends on
the number of token in a place.  Indeed, if there is no tokens, then
the fireIt of the output transition can only occur after the fireIt
event of the input transition has occured. It is expressed by the first
invariant defined in the context of a Place.
If there is some tokens in a place, then the fireIt event of the output
transition may occur as many times as there is tokens in this place.
After, it will only occur when the fireIt on the input transition of the
place has occured.  It is expressed using the DelayFor expression in the
second envariant of Place.</li><li class="listitem">Two other constraints are defined in the context of the MarkedGraph
element.  The first one expresses that the first initIt event must occur
before any fireIt event.  The second one expresses that the initIt event
can occur only one time.</li></ul></div></li></ol></div><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">Please notice that, as often, DSE are defined at the language
level, but at runtime they are instantiated as MSE on each object
instance of the metaclasse they are defined on.  For example, there will be
one fireIt MSE for each Transition element of MarkedGraph model.  For the
wikipedia example, there will a fireIt event for transitions t1, t2, t3 and
t4. In the same way, constraints apply to the MSE.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;4.&nbsp;Define the Execution Semantics&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="GuideTutorialMarkedGraph.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;5.&nbsp;Execute a Model</td></tr></table></div></body></html>