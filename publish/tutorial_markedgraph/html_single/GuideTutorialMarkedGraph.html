<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Tutorial</title><link rel="stylesheet" href="css/docbook.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book" title="Tutorial"><div class="titlepage"><div><div><h1 class="title"><a name="d0e3"></a>Tutorial</h1></div><div><h2 class="subtitle">Make Marked Graph models executable with the GEMOC Studio</h2></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="part"><a href="#_tutorial_make_marked_graph_models_executable_with_the_gemoc_studio">I. Tutorial: Make Marked Graph models executable with the GEMOC Studio</a></span></dt><dd><dl><dt><span class="chapter"><a href="#_what_is_expected_at_the_end_of_this_tutorial">1. What is expected at the end of this tutorial</a></span></dt><dt><span class="chapter"><a href="#_install_the_projects_defining_the_marked_graph_as_and_cs">2. Install the projects defining the Marked Graph AS and CS</a></span></dt><dd><dl><dt><span class="section"><a href="#_import_the_marked_graph_as_and_cs">2.1. Import the Marked Graph AS and CS</a></span></dt><dt><span class="section"><a href="#_abstract_syntax">2.2. Abstract Syntax</a></span></dt><dt><span class="section"><a href="#_concrete_syntax_and_sample_model">2.3. Concrete Syntax and Sample Model</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_set_up_an_xdsml_project">3. Set up an xDSML project</a></span></dt><dd><dl><dt><span class="section"><a href="#_create_an_xdsml_project">3.1. Create an xDSML Project</a></span></dt><dt><span class="section"><a href="#_open_xdsml_view">3.2. Open xDSML View</a></span></dt><dt><span class="section"><a href="#_select_the_as">3.3. Select the AS</a></span></dt><dt><span class="section"><a href="#_select_the_graphical_editor">3.4. Select the Graphical Editor</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_define_the_execution_semantics">4. Define the Execution Semantics</a></span></dt><dd><dl><dt><span class="section"><a href="#_define_dsa">4.1. Define DSA</a></span></dt><dd><dl><dt><span class="section"><a href="#_extend_the_as_with_ed_and_ef">4.1.1. Extend the AS with ED and EF</a></span></dt><dt><span class="section"><a href="#_create_the_dsa_project">4.1.2. Create the DSA Project</a></span></dt><dt><span class="section"><a href="#_implement_the_dsa">4.1.3. Implement the DSA</a></span></dt></dl></dd><dt><span class="section"><a href="#_define_dse">4.2. Define DSE</a></span></dt><dd><dl><dt><span class="section"><a href="#_create_the_dse_project">4.2.1. Create the DSE Project</a></span></dt><dt><span class="section"><a href="#_define_dse_2">4.2.2. Define DSE</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_define_animation_viewpoint">5. Define Animation Viewpoint</a></span></dt><dd><dl><dt><span class="section"><a href="#_create_a_debug_representation_as_an_extension_of_the_graphical_editor_viewpoint">5.1. Create a debug representation (as an extension of the graphical editor viewpoint)</a></span></dt><dd><dl><dt><span class="section"><a href="#_run_the_wizard">5.1.1. Run the wizard</a></span></dt><dt><span class="section"><a href="#_open_the_markedgraph_animation_odesign">5.1.2. Open the markedgraph-animation.odesign</a></span></dt><dt><span class="section"><a href="#_load_markedgraph_odesign_as_a_resource">5.1.3. Load markedgraph.odesign as a resource.</a></span></dt><dt><span class="section"><a href="#_add_markedgraph_ecore_to_the_metamodels">5.1.4. Add markedgraph.ecore to the metamodels</a></span></dt><dt><span class="section"><a href="#_complete_the_debug_representation">5.1.5. Complete the debug representation</a></span></dt><dt><span class="section"><a href="#_complete_the_dependencies_of_the_project">5.1.6. Complete the dependencies of the project</a></span></dt><dt><span class="section"><a href="#_set_the_animation_viewpoint_in_project_xml">5.1.7. Set the animation viewpoint in project.xml</a></span></dt></dl></dd><dt><span class="section"><a href="#_create_an_animation_representation">5.2. Create an animation representation</a></span></dt><dd><dl><dt><span class="section"><a href="#_create_the_animation_layer">5.2.1. Create the Animation Layer</a></span></dt><dt><span class="section"><a href="#_display_the_firable_transition_with_a_green_background_color">5.2.2. Display the firable transition with a green background color</a></span></dt><dt><span class="section"><a href="#_set_the_background_color_of_a_place_to_light_yellow">5.2.3. Set the background color of a place to light_yellow</a></span></dt><dt><span class="section"><a href="#_display_the_runtime_token_count_in_a_place">5.2.4. Display the runtime token count in a place</a></span></dt><dt><span class="section"><a href="#_add_the_animation_service">5.2.5. Add the Animation service</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_animate_a_model">6. Animate a Model</a></span></dt><dd><dl><dt><span class="section"><a href="#_launch_the_modeling_workbench">6.1. Launch the Modeling WorkBench</a></span></dt><dt><span class="section"><a href="#_import_the_project_with_a_sample_model">6.2. Import the project with a sample model</a></span></dt><dt><span class="section"><a href="#_select_the_modeling_perspective">6.3. Select the Modeling perspective</a></span></dt><dt><span class="section"><a href="#_create_a_launch_configuration">6.4. Create a Launch Configuration</a></span></dt><dt><span class="section"><a href="#_launch_the_execution_of_the_model">6.5. Launch the execution of the model</a></span></dt><dt><span class="section"><a href="#_select_a_logical_step">6.6. Select a logical step</a></span></dt><dt><span class="section"><a href="#_stop_the_execution">6.7. Stop the execution</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_going_further">7. Going further&#8230;&#8203;</a></span></dt><dd><dl><dt><span class="section"><a href="#_define_a_moccml_library_using_ccsl">7.1. Define a MoCCML library using CCSL</a></span></dt><dt><span class="section"><a href="#_using_it_in_the_ecl_file">7.2. Using it in the ECL file</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_use_constraint_automata_to_define_the_mocc">8. Use constraint automata to define the MoCC</a></span></dt><dd><dl><dt><span class="section"><a href="#_define_the_constraint_automaton_using_moccml_editor">8.1. Define the constraint automaton using MoCCML editor</a></span></dt></dl></dd></dl></dd></dl></div><div class="list-of-figures"><p><b>List of Figures</b></p><dl><dt>1.1. <a href="#d0e27">Expected animation for Marked Graph models</a></dt><dt>2.1. <a href="#d0e100">Abstract Syntax (Metamodel) of MarkedGraph</a></dt><dt>2.2. <a href="#d0e120">Example of a Marked Graph model (from wikipedia)</a></dt><dt>3.1. <a href="#d0e145">Create an xDSML Project</a></dt><dt>3.2. <a href="#d0e159">Define the name of the project</a></dt><dt>3.3. <a href="#d0e176">Define the name of the language</a></dt><dt>3.4. <a href="#d0e196">Content of the xDSML Project</a></dt><dt>3.5. <a href="#d0e207">The xDSML Editor</a></dt><dt>3.6. <a href="#d0e221">Browse to select the AS project</a></dt><dt>3.7. <a href="#d0e232">Browse to select the genmodel resource</a></dt><dt>3.8. <a href="#d0e243">Browse to select the root container</a></dt><dt>3.9. <a href="#d0e259">Select Sirius graphical editor</a></dt><dt>4.1. <a href="#d0e338">Abstract Syntax of MarkedGraph extended with Execution Data (ED) and Execution Functions (EF)</a></dt><dt>4.2. <a href="#d0e355">Create a K3 Project</a></dt><dt>4.3. <a href="#d0e380">Definition of the DSA (ED and EF)</a></dt><dt>4.4. <a href="#d0e410">Create a DSE Project</a></dt><dt>4.5. <a href="#d0e429">Template of the ECL file</a></dt><dt>4.6. <a href="#d0e454">Definition of the DSE (events and constraints)</a></dt><dt>5.1. <a href="#d0e526">Create GEMOC debug representation wizard</a></dt><dt>5.2. <a href="#d0e537">Select "Extends an existing diagram description"</a></dt><dt>5.3. <a href="#d0e548">Select the viewpoint to extend</a></dt><dt>5.4. <a href="#d0e559">Information of the animation viewpoint</a></dt><dt>6.1. <a href="#d0e768">Define the Marked Graph Modeling Workbench configuration</a></dt><dt>6.2. <a href="#d0e828">Define the configuration to run the wikipedia example</a></dt><dt>6.3. <a href="#d0e864">The wikipedia model is just started</a></dt><dt>6.4. <a href="#d0e878">One logical step selected</a></dt><dt>6.5. <a href="#d0e889">Execute a logical step</a></dt><dt>6.6. <a href="#d0e900">Transition t1 fired</a></dt><dt>6.7. <a href="#d0e909">Transition t2 fired</a></dt><dt>6.8. <a href="#d0e918">Some logical steps later</a></dt><dt>8.1. <a href="#d0e995">Graphical declaration of the placeReadWriteDef relation</a></dt><dt>8.2. <a href="#d0e1006">Automaton defining the placeReadWriteDef relation.</a></dt></dl></div><div class="part" title="Part&nbsp;I.&nbsp;Tutorial: Make Marked Graph models executable with the GEMOC Studio"><div class="titlepage"><div><div><h1 class="title"><a name="_tutorial_make_marked_graph_models_executable_with_the_gemoc_studio"></a>Part&nbsp;I.&nbsp;Tutorial: Make Marked Graph models executable with the GEMOC Studio</h1></div></div></div><div class="chapter" title="Chapter&nbsp;1.&nbsp;What is expected at the end of this tutorial"><div class="titlepage"><div><div><h2 class="title"><a name="_what_is_expected_at_the_end_of_this_tutorial"></a>Chapter&nbsp;1.&nbsp;What is expected at the end of this tutorial</h2></div></div></div><p>This tutorial aims at demonstrating the power of the GEMOC studio to
define an executable semantics and provide graphical animation for a
DSML.   It relies of the
<a class="link" href="http://en.wikipedia.org/wiki/Marked_graph" target="_top">marked graph</a> language.</p><p>The <a class="link" href="images/MarkedGraph/MarkedGraph-wikipedia-anim-all.gif" target="_top">following animation</a> shows the expecting results of this tutorial:
according to the fired transitions, tokens move from place to place.</p><div class="figure"><a name="d0e27"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MarkedGraph-wikipedia-anim-all.gif" alt="Expected animation for Marked Graph models"></div></div><p class="title"><b>Figure&nbsp;1.1.&nbsp;Expected animation for Marked Graph models</b></p></div><br class="figure-break"></div><div class="chapter" title="Chapter&nbsp;2.&nbsp;Install the projects defining the Marked Graph AS and CS"><div class="titlepage"><div><div><h2 class="title"><a name="_install_the_projects_defining_the_marked_graph_as_and_cs"></a>Chapter&nbsp;2.&nbsp;Install the projects defining the Marked Graph AS and CS</h2></div></div></div><p>The domain model is implemented with several EMF projects that you
need to import into your workspace.
A graphical editor defined with Sirius is also available to visualize
and edit Marked Graph models.</p><div class="section" title="2.1.&nbsp;Import the Marked Graph AS and CS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_import_the_marked_graph_as_and_cs"></a>2.1.&nbsp;Import the Marked Graph AS and CS</h2></div></div></div><p>Download the
<a class="link" href="MarkedGraph/org.gemoc.sample.markedgraph.zip" target="_top">provided
archive</a> containing the projects and unzip it.  Then, with the GEMOC
Studio, select <span class="emphasis"><em>import&#8230;&#8203; / General / Existing Projects into
Workspace</em></span> and import all the projects from the archive file.</p><p><a class="link" href="MarkedGraph/org.gemoc.sample.markedgraph-final.zip" target="_top">Here is the archive
containing all the projects</a> that will be created during this tutorial.</p></div><div class="section" title="2.2.&nbsp;Abstract Syntax"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_abstract_syntax"></a>2.2.&nbsp;Abstract Syntax</h2></div></div></div><p>Marked Graph is a kind of
<a class="link" href="http://en.wikipedia.org/wiki/Petri_net" target="_top">Petri net</a>
in which every place has exactly one incoming arc and exactly one
outgoing arc.  As a consequence, it a concurrent language (several
transitions may be fired) and has no conflict.</p><p>The Domain Model, also called Abstract Syntax or Metamodel, defines :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">A <span class="emphasis"><em>marked graph</em></span> as a set of <span class="emphasis"><em>places</em></span> and <span class="emphasis"><em>transitions</em></span>.</li><li class="listitem">Each <span class="emphasis"><em>Place</em></span> has exactly one <span class="emphasis"><em>input</em></span> transition and one <span class="emphasis"><em>output</em></span>
transition and a token count.</li><li class="listitem">A transition has several <span class="emphasis"><em>input</em></span> places and several <span class="emphasis"><em>output</em></span>
places.</li></ul></div><div class="figure"><a name="d0e100"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MarkedGraph-AS.png" alt="MarkedGraph Domain Model (Metamodel)"></div></div><p class="title"><b>Figure&nbsp;2.1.&nbsp;Abstract Syntax (Metamodel) of MarkedGraph</b></p></div><br class="figure-break"></div><div class="section" title="2.3.&nbsp;Concrete Syntax and Sample Model"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_concrete_syntax_and_sample_model"></a>2.3.&nbsp;Concrete Syntax and Sample Model</h2></div></div></div><p>The graphical concrete syntax draws places as
circles and transitions as squares.  Inputs and outputs of places and
transitions are designated by arrows.  The following picture shows the
graphical representation of the
<a class="link" href="http://en.wikipedia.org/wiki/Marked_graph" target="_top">Marked Graph model of wikipedia</a>
(using a graphical syntax defined using
<a class="link" href="http://www.eclipse.org/sirius/" target="_top">Sirius</a>).</p><div class="figure"><a name="d0e120"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-model-wikipedia.png" alt="Example of a Marked Graph model (from wikipedia)"></div></div><p class="title"><b>Figure&nbsp;2.2.&nbsp;Example of a Marked Graph model (from <a class="link" href="http://en.wikipedia.org/wiki/Marked_graph" target="_top">wikipedia</a>)</b></p></div><br class="figure-break"></div></div><div class="chapter" title="Chapter&nbsp;3.&nbsp;Set up an xDSML project"><div class="titlepage"><div><div><h2 class="title"><a name="_set_up_an_xdsml_project"></a>Chapter&nbsp;3.&nbsp;Set up an xDSML project</h2></div></div></div><p>In this section, we first create an xDSML project for MarkedGraph
and initialize it with the provided Abstract Syntax (AS) and Concrete
Syntax (CS).</p><div class="section" title="3.1.&nbsp;Create an xDSML Project"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_create_an_xdsml_project"></a>3.1.&nbsp;Create an xDSML Project</h2></div></div></div><p>Select an xDSML project (<span class="emphasis"><em>New &gt; Project &gt; GEMOC
Project / new GEMOC Concurrent xDSML Project</em></span>).</p><div class="figure"><a name="d0e145"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-SelectGemocLanguageProject.png" width="800" alt="Create an xDSML Project"></div></div><p class="title"><b>Figure&nbsp;3.1.&nbsp;Create an xDSML Project</b></p></div><br class="figure-break"><p>The first dialog of the wizard asks for the name of the project. Define
it as <span class="emphasis"><em>org.gemoc.sample.markedgraph.xdsml</em></span>.</p><div class="figure"><a name="d0e159"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-SelectGemocLanguageProject-ProjectName.png" width="800" alt="Define the name of the project"></div></div><p class="title"><b>Figure&nbsp;3.2.&nbsp;Define the name of the project</b></p></div><br class="figure-break"><p>Click on <span class="emphasis"><em>Next</em></span>  and define the name of the language (<span class="emphasis"><em>markedgraph</em></span>).</p><div class="figure"><a name="d0e176"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-SelectGemocLanguageProject-LanguageName.png" width="800" alt="Define the name of the language"></div></div><p class="title"><b>Figure&nbsp;3.3.&nbsp;Define the name of the language</b></p></div><br class="figure-break"></div><div class="section" title="3.2.&nbsp;Open xDSML View"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_open_xdsml_view"></a>3.2.&nbsp;Open xDSML View</h2></div></div></div><p>A file <span class="emphasis"><em>project.xml</em></span> has been created in the
<span class="emphasis"><em>org.gemoc.sample.markedgraph.xdsml</em></span> project.</p><div class="figure"><a name="d0e196"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-XDSML-content.png" width="800" alt="Content of the xDSML Project"></div></div><p class="title"><b>Figure&nbsp;3.4.&nbsp;Content of the xDSML Project</b></p></div><br class="figure-break"><p>When opened, it provides the xDSML view which summarizes all the
important resources used in an xDSML project (which are part of and
managed by other projects).  This view is a kind of control center to
have quick access to the main resources of the project.</p><div class="figure"><a name="d0e207"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-XDSML-start.png" width="800" alt="The xDSML Editor"></div></div><p class="title"><b>Figure&nbsp;3.5.&nbsp;The xDSML Editor</b></p></div><br class="figure-break"></div><div class="section" title="3.3.&nbsp;Select the AS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_select_the_as"></a>3.3.&nbsp;Select the AS</h2></div></div></div><p>In the "Domain Model" section, click on the "Browse" button to select
the project defining the AS: org.gemoc.sample.markedgraph.model.</p><div class="figure"><a name="d0e221"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-XDSML-EMF-Browse.png" width="800" alt="Browse to select the AS project"></div></div><p class="title"><b>Figure&nbsp;3.6.&nbsp;Browse to select the AS project</b></p></div><br class="figure-break"><p>Then, select the "Genmodel URI".</p><div class="figure"><a name="d0e232"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-XDSML-EMF-genmodel-browse.png" width="800" alt="Browse to select the genmodel resource"></div></div><p class="title"><b>Figure&nbsp;3.7.&nbsp;Browse to select the genmodel resource</b></p></div><br class="figure-break"><p>Finally, select the "Root container model
element" thanks to the "Select" buttons.</p><div class="figure"><a name="d0e243"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-XDSML-EMF-root-browse.png" width="800" alt="Browse to select the root container"></div></div><p class="title"><b>Figure&nbsp;3.8.&nbsp;Browse to select the root container</b></p></div><br class="figure-break"></div><div class="section" title="3.4.&nbsp;Select the Graphical Editor"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_select_the_graphical_editor"></a>3.4.&nbsp;Select the Graphical Editor</h2></div></div></div><p>The Graphical Editor defines a graphical concrete syntax which is
user-friendly to view and edit a model.</p><p>In the "Concrete syntax definition / Graphical editor" of the
project.xdsml editor, click on "Browse" to select the
"org.gemoc.markedgraph.design" project.</p><div class="figure"><a name="d0e259"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-XDSML-CS-select.png" width="800" alt="Select Sirius graphical editor"></div></div><p class="title"><b>Figure&nbsp;3.9.&nbsp;Select Sirius graphical editor</b></p></div><br class="figure-break"></div></div><div class="chapter" title="Chapter&nbsp;4.&nbsp;Define the Execution Semantics"><div class="titlepage"><div><div><h2 class="title"><a name="_define_the_execution_semantics"></a>Chapter&nbsp;4.&nbsp;Define the Execution Semantics</h2></div></div></div><p>A transition can be fired if there is at least one token in every of
each input place.  When a transition is fired, one token is removed from each
of its input places and one token is added to each of its output places.
Several transitions can be fired as the same time.</p><p>Defining the execution semantics consists in implementing the previous
behavior.  In the GEMOC approach, it is split in different concerns:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">The definition of Execution Data (ED) like the runtime count of
tokens in a place and Execution Functions (EF) like fire a transition.
ED and EF constitute <span class="strong"><strong>the DSA</strong></span>.</li><li class="listitem">The definition of the model of concurrency as a set of events and
constraints on these events.  It is <span class="strong"><strong>the MoCC</strong></span> concern that is
defined in a DSE project (using ECL, Event Constraint Language)
possibly completed with MoCCML projects  to define libraries of
constraints.</li><li class="listitem">The <span class="strong"><strong>mapping</strong></span> between the DSA and the MoCC.</li></ul></div><p>In the current version of the GEMOC studio, the MoCC and the mapping
are tightly coupled and described in ECL (Event Constraint Language).</p><div class="section" title="4.1.&nbsp;Define DSA"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_define_dsa"></a>4.1.&nbsp;Define DSA</h2></div></div></div><p>During execution of a MarkedGraph, the number of tokens of a place has
to be recorded and changed according to the fired transitions.  Thus,
we have to manage an execution data (ED) called runtimeTokenCount and
an execution function (EF) on Transition called fire().  Furthermore,
the runtimeTokenCount of each place must be initialized at the start
of the execution. It is the purpose of the EF called initialize() on
the MarkedGraph element.</p><p>The DSA of Marked Graph is composed of :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">one ED called  <span class="emphasis"><em>runtimeTokenCount</em></span>
defined on <span class="emphasis"><em>Place</em></span> . It represents the number of token in a place when the
model is executed.</li><li class="listitem">one EF called initialize() defined
on <span class="emphasis"><em>MarkedGraph</em></span>. It initializes the runtime token count of each
place with the initial token count.</li><li class="listitem">one ED called <span class="emphasis"><em>fire()</em></span> on
<span class="emphasis"><em>Transition</em></span>. It to remove one token from each of its input places
and add one token to all its output places.</li></ul></div><div class="section" title="4.1.1.&nbsp;Extend the AS with ED and EF"><div class="titlepage"><div><div><h3 class="title"><a name="_extend_the_as_with_ed_and_ef"></a>4.1.1.&nbsp;Extend the AS with ED and EF</h3></div></div></div><p>At the moment, we need to complete the AS (markedgraph.ecore) with the
ED and EF.  In the next release of the GEMOC Studio this step replaced by the
use of <a class="link" href="http://melange-lang.org/" target="_top">Melange</a> to automatically extend the AS
with ED and EF.</p><p>The ED and and EF are already defined on the provided metamodel.  Thus, there
is no need to add the 'runtimeTokenCount' ED on Place, 'fire()' on Transition
and 'initialize()' on MarkedGraph.</p><div class="figure"><a name="d0e338"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MarkedGraph-AS-DSA.png" alt="Abstract Syntax of MarkedGraph extended with Execution Data (ED) and Execution Functions (EF)"></div></div><p class="title"><b>Figure&nbsp;4.1.&nbsp;Abstract Syntax of MarkedGraph extended with Execution Data (ED) and Execution Functions (EF)</b></p></div><br class="figure-break"></div><div class="section" title="4.1.2.&nbsp;Create the DSA Project"><div class="titlepage"><div><div><h3 class="title"><a name="_create_the_dsa_project"></a>4.1.2.&nbsp;Create the DSA Project</h3></div></div></div><p>Click on <span class="emphasis"><em>K3 project</em></span> in the project.xdml editor (Behavioral definition / DSA
definition).  The wizard to create of new Kermeta 3 project is
launched with the name of the project initialized (k3dsa is the last
name). Click "Finish".  The project has been created.</p><div class="figure"><a name="d0e355"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-K3-Create.png" width="800" alt="Create a K3 Project"></div></div><p class="title"><b>Figure&nbsp;4.2.&nbsp;Create a K3 Project</b></p></div><br class="figure-break"></div><div class="section" title="4.1.3.&nbsp;Implement the DSA"><div class="titlepage"><div><div><h3 class="title"><a name="_implement_the_dsa"></a>4.1.3.&nbsp;Implement the DSA</h3></div></div></div><p>Click again on <span class="emphasis"><em>K3 project</em></span> to open <span class="emphasis"><em>markedgraph.xtend</em></span>.  It
has been initialized with a template that can be discarded and
replaced with the <a class="link" href="MarkedGraph/markedgraph.xtend" target="_top">following text</a>.</p><pre class="screen">package markedgraph.aspects

import fr.inria.diverse.k3.al.annotationprocessor.Aspect
import markedgraph.MarkedGraph
import markedgraph.Place
import markedgraph.Transition

import static extension markedgraph.aspects.PlaceAspect.*

@Aspect(className=MarkedGraph)
class MarkedGraphAspect {
	def public void initialize() {
		println("Graph " + _self.name + " initialized.")
		_self.places.forEach [ pl | pl.initialize ]
	}
}

@Aspect(className=Place)
class PlaceAspect {
	public int runtimeTokenCount

	// @Helper
	def public void initialize() {
		println("Place " + _self.name + ": initialized.")
		_self.runtimeTokenCount = _self.tokenCount
	}
}

@Aspect(className=Transition)
class TransitionAspect {
	def public void fire() {
		println("Transition " + _self.name + ": fired.")
		_self.inputs.forEach[ runtimeTokenCount = runtimeTokenCount - 1 ]
		_self.outputs.forEach[ runtimeTokenCount = runtimeTokenCount + 1 ]
	}
}</pre><div class="figure"><a name="d0e380"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-K3-Defined.png" width="800" alt="Definition of the DSA (ED and EF)"></div></div><p class="title"><b>Figure&nbsp;4.3.&nbsp;Definition of the DSA (ED and EF)</b></p></div><br class="figure-break"></div></div><div class="section" title="4.2.&nbsp;Define DSE"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_define_dse"></a>4.2.&nbsp;Define DSE</h2></div></div></div><p>The purpose of the DSE project is to define events (called DSE) on AS
elements that will trigger EF calls when they occurs.  Furthermore,
constraints can be defined on these events to define when they may occur.</p><div class="section" title="4.2.1.&nbsp;Create the DSE Project"><div class="titlepage"><div><div><h3 class="title"><a name="_create_the_dse_project"></a>4.2.1.&nbsp;Create the DSE Project</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Click on the "ECL Project" in the
<span class="emphasis"><em>project.xdsml</em></span> editor ("Behavior definition / DSE definition").</li><li class="listitem">Check that the name is <span class="emphasis"><em>org.gemoc.sample.markedgraph.dse</em></span>.</li></ul></div><div class="figure"><a name="d0e410"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-DSE-Create.png" width="800" alt="Create a DSE Project"></div></div><p class="title"><b>Figure&nbsp;4.4.&nbsp;Create a DSE Project</b></p></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Click "Next".  All fields have been correctly initialized.</li><li class="listitem">Click "finish" and the project is created.</li><li class="listitem">Click on "ECL Project" to view the "markedgraph.ecl".</li></ul></div><div class="figure"><a name="d0e429"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-DSE-Template.png" width="800" alt="Template of the ECL file"></div></div><p class="title"><b>Figure&nbsp;4.5.&nbsp;Template of the ECL file</b></p></div><br class="figure-break"></div><div class="section" title="4.2.2.&nbsp;Define DSE"><div class="titlepage"><div><div><h3 class="title"><a name="_define_dse_2"></a>4.2.2.&nbsp;Define DSE</h3></div></div></div><p>Replace the content of the ECL file with the
<a class="link" href="MarkedGraph/markedgraph.ecl" target="_top">following code</a> (explanations on
this code are given bellow):</p><p title="The file markedgraph.ecl"><b>The file markedgraph.ecl.&nbsp;</b>
</p><pre class="screen">import 'platform:/resource/org.gemoc.sample.markedgraph.model/model/markedgraph.ecore'

ECLimport "platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/kernel.ccslLib"
ECLimport "platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/CCSL.ccslLib"

package markedgraph

	context MarkedGraph
		def: initIt: Event = self.initialize()

	context Transition
		def: fireIt: Event = self.fire()

	context Place
		inv tokenCountIsNull:
			(self.tokenCount = 0) implies
				(Relation Precedes(self.input.fireIt, self.output.fireIt))
		inv tokenCountIsNotNullDelayRequired:
			(self.tokenCount &gt; 0) implies
				let delay: Integer = self.tokenCount in
				let outputDelayed: Event =
					Expression DelayFor(self.output.fireIt, self.output.fireIt, delay) in
						Relation Precedes(self.input.fireIt, outputDelayed)

	context MarkedGraph
        inv initFirst:
                let firstInit : Event = Expression OneTickAndNoMore(self.initIt) in
                let allFire : Event = Expression Union(self.transitions.fireIt) in
                let firstOfAllFire : Event = Expression OneTickAndNoMore(allFire) in
                Relation Precedes(firstInit, firstOfAllFire)

        inv onlyOneInit:
                let firstInit2 : Event = Expression OneTickAndNoMore(self.initIt) in
                Relation Coincides(self.initIt, firstInit2)

endpackage</pre><p title="The file markedgraph.ecl">
</p><div class="figure"><a name="d0e454"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-DSE-Defined.png" width="800" alt="Definition of the DSE (events and constraints)"></div></div><p class="title"><b>Figure&nbsp;4.6.&nbsp;Definition of the DSE (events and constraints)</b></p></div><br class="figure-break"><p>This step has three main purposes:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">First, it specifies DSE in the context of metaclasses of the AS.
For Marked Graph xDSML, we identify 2 DSE:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">fireIt: defined in the context of a Transition</li><li class="listitem">initIt: defined in the context of a MarkedGraph</li></ul></div></li><li class="listitem"><p class="simpara">Then, it links them to EF from DSA --- when a DSE will occur the
associated EF will be executed.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">fireIt is linked to the EF 'fire' of Transition</li><li class="listitem">initIt is linked to the EF 'initialize' of MarkedGraph</li></ul></div></li><li class="listitem"><p class="simpara">Finally, it defines constraints on the DSE to rule the possible
scheduling.  Constraints generally rely on relations which are defined
in MoCC libraries. Here constraints are expressed in CCSL and only relies
on relations and expression from the CCSL core library.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">A first constraint applies on the fireIt events.  It is depends on
the number of token in a place.  Indeed, if there is no tokens, then
the fireIt of the output transition can only occur after the fireIt
event of the input transition has occured. It is expressed by the first
invariant defined in the context of a Place.
If there is some tokens in a place, then the fireIt event of the output
transition may occur as many times as there is tokens in this place.
After, it will only occur when the fireIt on the input transition of the
place has occured.  It is expressed using the DelayFor expression in the
second envariant of Place.</li><li class="listitem">Two other constraints are defined in the context of the MarkedGraph
element.  The first one expresses that the first initIt event must occur
before any fireIt event.  The second one expresses that the initIt event
can occur only one time.</li></ul></div></li></ol></div><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">Please notice that, as often, DSE are defined at the language
level, but at runtime they are instantiated as MSE on each object
instance of the metaclasse they are defined on.  For example, there will be
one fireIt MSE for each Transition element of MarkedGraph model.  For the
wikipedia example, there will a fireIt event for transitions t1, t2, t3 and
t4. In the same way, constraints apply to the MSE.</p></div></div></div></div><div class="chapter" title="Chapter&nbsp;5.&nbsp;Define Animation Viewpoint"><div class="titlepage"><div><div><h2 class="title"><a name="_define_animation_viewpoint"></a>Chapter&nbsp;5.&nbsp;Define Animation Viewpoint</h2></div></div></div><p>During the execution of a Marked Graph model, we want to visualize :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">the number of tokens in any place: the runtime token count will be printed in the circle of one place.</li><li class="listitem">the firable transitions: they will be drawn in green.</li></ul></div><p>As the animation view is close to the graphical concrete syntax, we
extend the existing diagram description.</p><p>First, we will define a graphical representation based on the graphical
Marked Graph syntax to the wizard called "Create GEMOC debug
representation", then we will add a layer to describe the graphical
animation of a Marked Graph model.</p><div class="section" title="5.1.&nbsp;Create a debug representation (as an extension of the graphical editor viewpoint)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_create_a_debug_representation_as_an_extension_of_the_graphical_editor_viewpoint"></a>5.1.&nbsp;Create a debug representation (as an extension of the graphical editor viewpoint)</h2></div></div></div><div class="section" title="5.1.1.&nbsp;Run the wizard"><div class="titlepage"><div><div><h3 class="title"><a name="_run_the_wizard"></a>5.1.1.&nbsp;Run the wizard</h3></div></div></div><p>Tun the wizard with <span class="emphasis"><em>New &gt; Other / Create GEMOC debug representation</em></span>.</p><div class="figure"><a name="d0e526"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-animation-wizard-launch.png" alt="Create GEMOC debug representation wizard"></div></div><p class="title"><b>Figure&nbsp;5.1.&nbsp;Create GEMOC debug representation wizard</b></p></div><br class="figure-break"><p>On the first screen of the wizad, select "Extends an existing diagram
description".</p><div class="figure"><a name="d0e537"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-animation-wizard-choose.png" alt="Select &#34;Extends an existing diagram description&#34;"></div></div><p class="title"><b>Figure&nbsp;5.2.&nbsp;Select "Extends an existing diagram description"</b></p></div><br class="figure-break"><p>Select the viewpoint to extend "MarkedGraph diagram".</p><div class="figure"><a name="d0e548"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-animation-wizard-select-viewpoint.png" alt="Select the viewpoint to extend"></div></div><p class="title"><b>Figure&nbsp;5.3.&nbsp;Select the viewpoint to extend</b></p></div><br class="figure-break"><p>Finally, we can fill in the Project Name in which the newly creating
viewpoint file will take place (org.gemoc.sample.markedgraph.animation),
the name of the viewpoint file (markedgraph-animation.odesign), the
viewpoint name (MarkedGraphViewpoint) and the diagram name (MarkedGraph).</p><div class="figure"><a name="d0e559"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-animation-wizard-set-names.png" alt="Information of the animation viewpoint"></div></div><p class="title"><b>Figure&nbsp;5.4.&nbsp;Information of the animation viewpoint</b></p></div><br class="figure-break"><p>The last screen allows to choose the name of the layer to be created. Debug
is a good name.</p><p>Once the <span class="emphasis"><em>Finish</em></span> button is pressed, the project is created.</p></div><div class="section" title="5.1.2.&nbsp;Open the markedgraph-animation.odesign"><div class="titlepage"><div><div><h3 class="title"><a name="_open_the_markedgraph_animation_odesign"></a>5.1.2.&nbsp;Open the markedgraph-animation.odesign</h3></div></div></div><p>Open the markedgraph-animation.odesign file and develop its content.</p></div><div class="section" title="5.1.3.&nbsp;Load markedgraph.odesign as a resource."><div class="titlepage"><div><div><h3 class="title"><a name="_load_markedgraph_odesign_as_a_resource"></a>5.1.3.&nbsp;Load markedgraph.odesign as a resource.</h3></div></div></div><p>To be able to complete the definition of the odesign file, we first need to
load the existing markedgraph.odesign as a resource :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Right click in the markedgraph.odesign editor to select <span class="emphasis"><em>Load Resource&#8230;&#8203;</em></span>.</li><li class="listitem">Select <span class="emphasis"><em>Browse workspace&#8230;&#8203;</em></span></li><li class="listitem">Select <span class="emphasis"><em>markedgraph.odesign</em></span> in the
<span class="emphasis"><em>org.gemoc.sample.markedgraph.design</em></span> project</li><li class="listitem">Click OK</li><li class="listitem">Click OK</li></ul></div></div><div class="section" title="5.1.4.&nbsp;Add markedgraph.ecore to the metamodels"><div class="titlepage"><div><div><h3 class="title"><a name="_add_markedgraph_ecore_to_the_metamodels"></a>5.1.4.&nbsp;Add markedgraph.ecore to the metamodels</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Select "Diagram Extension MarkedGraph" element.</li><li class="listitem">In the <span class="emphasis"><em>Properties</em></span> view, select <span class="emphasis"><em>metamodels</em></span>.</li><li class="listitem">Click on "Add from workspace".</li><li class="listitem">Select "markedgraph.ecore" (unfold the project structure)</li><li class="listitem">Click OK</li></ul></div></div><div class="section" title="5.1.5.&nbsp;Complete the debug representation"><div class="titlepage"><div><div><h3 class="title"><a name="_complete_the_debug_representation"></a>5.1.5.&nbsp;Complete the debug representation</h3></div></div></div><p>On the "Mapping Based Decoration Enabled breakpoint" and "Mapping Based
Decoration Disabled breakpoint", select the "Place" and "Transition"
element.</p><p>The debug view will show a symbol on the Place and Transition to show
whether the corresponding breakpoint is enabled or disabled.</p></div><div class="section" title="5.1.6.&nbsp;Complete the dependencies of the project"><div class="titlepage"><div><div><h3 class="title"><a name="_complete_the_dependencies_of_the_project"></a>5.1.6.&nbsp;Complete the dependencies of the project</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Open the plugin.xml file of the project.</li><li class="listitem">Select the <span class="emphasis"><em>dependencies</em></span> tab.</li><li class="listitem">Click "Add&#8230;&#8203;" in the "Required Plug-ins" area.</li><li class="listitem">Select "org.gemoc.gemoc_language_workbench.extensions.sirius"</li><li class="listitem">Click OK</li><li class="listitem">Save the plugin.xml resource.</li></ul></div></div><div class="section" title="5.1.7.&nbsp;Set the animation viewpoint in project.xml"><div class="titlepage"><div><div><h3 class="title"><a name="_set_the_animation_viewpoint_in_project_xml"></a>5.1.7.&nbsp;Set the animation viewpoint in project.xml</h3></div></div></div><p>In the xDSML editor, we can select the animation viewpoint by selecting the
newly created project (<span class="emphasis"><em>org.gemoc.sample.markedgraph.animation</em></span>)</p></div></div><div class="section" title="5.2.&nbsp;Create an animation representation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_create_an_animation_representation"></a>5.2.&nbsp;Create an animation representation</h2></div></div></div><p>After the debug presentation has been defined, we can complete it to add an
animation layer.</p><div class="section" title="5.2.1.&nbsp;Create the Animation Layer"><div class="titlepage"><div><div><h3 class="title"><a name="_create_the_animation_layer"></a>5.2.1.&nbsp;Create the Animation Layer</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Right click on "Diagram extension MarkedGraph" to <span class="emphasis"><em>select New Diagram
Element / Additional Layer</em></span>.</li><li class="listitem">Set its "id" to "Animation".</li></ul></div></div><div class="section" title="5.2.2.&nbsp;Display the firable transition with a green background color"><div class="titlepage"><div><div><h3 class="title"><a name="_display_the_firable_transition_with_a_green_background_color"></a>5.2.2.&nbsp;Display the firable transition with a green background color</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Right click on "Animation" to select "New Customization / Style
Customizations".</li><li class="listitem">Right click on "Style Customizations" to select "New Customization /
Style Customization".</li><li class="listitem"><p class="simpara">On "Style Customization", set the "Predicate Expression" to:</p><pre class="literallayout">[self.eGet('inputs')-&gt;forAll(p | p.eGet('runtimeTokenCount').toString().toInteger() &gt; 0) /]</pre></li><li class="listitem">Right click on "Style Customization" to select "New Customization /
Property Customization (by selection)"</li><li class="listitem">For "Applied On" property, select "Square white".</li><li class="listitem">For "Property Name", set "color" (completion is available with CTRL-SPACE)</li><li class="listitem">For "Value Selction", set "light_green"</li></ul></div></div><div class="section" title="5.2.3.&nbsp;Set the background color of a place to light_yellow"><div class="titlepage"><div><div><h3 class="title"><a name="_set_the_background_color_of_a_place_to_light_yellow"></a>5.2.3.&nbsp;Set the background color of a place to light_yellow</h3></div></div></div><p>Perform the same action as above to set the background color of places to
yellow.</p></div><div class="section" title="5.2.4.&nbsp;Display the runtime token count in a place"><div class="titlepage"><div><div><h3 class="title"><a name="_display_the_runtime_token_count_in_a_place"></a>5.2.4.&nbsp;Display the runtime token count in a place</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Right click on "Style Customization" to select "New Customization /
Property Customization (by expression)"</li><li class="listitem">For "Applied On" property, select "Ellipse white".</li><li class="listitem">For "Property Name", set "labelExpression" (completion is available with CTRL-SPACE)</li><li class="listitem">For "Value Selction", set "feature:runtimeTokenCount"</li></ul></div></div><div class="section" title="5.2.5.&nbsp;Add the Animation service"><div class="titlepage"><div><div><h3 class="title"><a name="_add_the_animation_service"></a>5.2.5.&nbsp;Add the Animation service</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Right click on "MarkedGraphViewpoint" to select "New Extension / Java
Extension".</li><li class="listitem">Set "Qualified Class Name" to
"org.gemoc.sample.markedgraph.animation.services.MarkedgraphAnimationServices".</li></ul></div><p>In the project, <span class="emphasis"><em>org.gemoc.sample.markedgraph.animation</em></span> project, in
src/org.gemoc.sample.markedgraph.animation.services, copy the
MarkedgraphDebugServices.java file to
MarkedgraphAnimationServices.java.  Then, change
AbstractGemocDebuggerServices to AbstractGemocAnimatorServices in its
source code (two times: import and extends).  Finally, change "Debug" to
"Animation".</p></div></div></div><div class="chapter" title="Chapter&nbsp;6.&nbsp;Animate a Model"><div class="titlepage"><div><div><h2 class="title"><a name="_animate_a_model"></a>Chapter&nbsp;6.&nbsp;Animate a Model</h2></div></div></div><p>The executable MarkedGraph Language is now defined.  We can use the
GEMOC Modeling Workbench to execute MarkedGraph models.</p><div class="section" title="6.1.&nbsp;Launch the Modeling WorkBench"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_launch_the_modeling_workbench"></a>6.1.&nbsp;Launch the Modeling WorkBench</h2></div></div></div><p>First, we will create a run configuration.  Select "run / run Configurations"
Double click on "Eclipse Application" and change the name "New
Configuration" into "Marked Graph Modeling Workbench".  We can now click
"Run" to start the new runtime Eclipse which indeed corresponds to the
Modeling Workbench for Marked Graph.</p><div class="figure"><a name="d0e768"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-run-EclipseApplicationConfig.png" alt="Define the Marked Graph Modeling Workbench configuration"></div></div><p class="title"><b>Figure&nbsp;6.1.&nbsp;Define the Marked Graph Modeling Workbench configuration</b></p></div><br class="figure-break"></div><div class="section" title="6.2.&nbsp;Import the project with a sample model"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_import_the_project_with_a_sample_model"></a>6.2.&nbsp;Import the project with a sample model</h2></div></div></div><p>Import the modeling project
<a class="link" href="MarkedGraph/org.gemoc.sample.markedgraph.sample.zip" target="_top">org.gemoc.sample.markedgraph.sample</a>
in the Modeling Workbench (Import / General / Existing project into
Workspace).  It contains the wikipedia.markedgraph file which corresponds
to the <a class="link" href="http://en.wikipedia.org/wiki/Marked_graph" target="_top">Wikipedia example</a>.</p></div><div class="section" title="6.3.&nbsp;Select the Modeling perspective"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_select_the_modeling_perspective"></a>6.3.&nbsp;Select the Modeling perspective</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Select "Window / Open Perspective / Others&#8230;&#8203;"</li><li class="listitem">Select "Modeling" in the list.</li></ul></div></div><div class="section" title="6.4.&nbsp;Create a Launch Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_create_a_launch_configuration"></a>6.4.&nbsp;Create a Launch Configuration</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Select <span class="emphasis"><em>Debug / Debug Configurations</em></span></li><li class="listitem">Double click on "Gemoc Concurrent eXecutable Model"</li><li class="listitem">Change the name of the new configuration to "run wikipedia example"</li><li class="listitem">Browse to select the model to run (wikipedia.markedgraph)</li><li class="listitem">Select its language (xDSML field): markedgraph</li><li class="listitem">Browse to select the animator</li><li class="listitem">Check that the "Decider" is set to "Step by step user decider" (the user
will decide which well be the next step to execute).</li><li class="listitem">Click on "Debug"</li></ul></div><div class="figure"><a name="d0e828"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-run-WikipediaConfig.png" alt="Define the configuration to run the wikipedia example"></div></div><p class="title"><b>Figure&nbsp;6.2.&nbsp;Define the configuration to run the wikipedia example</b></p></div><br class="figure-break"></div><div class="section" title="6.5.&nbsp;Launch the execution of the model"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_launch_the_execution_of_the_model"></a>6.5.&nbsp;Launch the execution of the model</h2></div></div></div><p>We can now run the "gemoc" configuration.  It opens the different views related to the execution on an xDSML model:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Logical Steps (top left): the list of the logical steps that may be
selected at this execution step.</li><li class="listitem">Gemoc Engine Status (middle left): the list on the running GEMOC engines.
The red button stops the selected engine.</li><li class="listitem">Stimuli Manager (bottom left): the list of MSE.</li><li class="listitem">VCD (top right): a graphical visualisation of the events manages by the
MoCC (first ones correspond to the MSE).</li><li class="listitem">Graphical visualization (middle right) of the model (with animation
information)</li><li class="listitem">Time Line (bottom middle): the logical steps available at each steps and
the selected one.</li><li class="listitem">Console: several consoles are available.  The dispolayed one is the
"Default MessaginSystem Console". There is one console the the main
component of the Modeling Workbench.</li></ul></div><div class="figure"><a name="d0e864"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-run-start.png" alt="The wikipedia model is just started"></div></div><p class="title"><b>Figure&nbsp;6.3.&nbsp;The wikipedia model is just started</b></p></div><br class="figure-break"></div><div class="section" title="6.6.&nbsp;Select a logical step"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_select_a_logical_step"></a>6.6.&nbsp;Select a logical step</h2></div></div></div><p>The Logical Steps view, presents the possible steps, and for each step,
the MSE that will occur if it is selected.</p><div class="figure"><a name="d0e878"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-run-start-select.png" alt="One logical step selected"></div></div><p class="title"><b>Figure&nbsp;6.4.&nbsp;One logical step selected</b></p></div><br class="figure-break"><p>Double-click on a Logical Step to choose it.  The corresponding MSE
occur, they are visible on the VCD, and they trigger the associated
execution functions which make the state of the model evolve.</p><div class="figure"><a name="d0e889"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-run-init.png" alt="Execute a logical step"></div></div><p class="title"><b>Figure&nbsp;6.5.&nbsp;Execute a logical step</b></p></div><br class="figure-break"><p>Then, we can select a new logical step (here we selected the the logical step which fires the t2 transition).</p><div class="figure"><a name="d0e900"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-run-t1-fired.png" alt="Transition t1 fired"></div></div><p class="title"><b>Figure&nbsp;6.6.&nbsp;Transition t1 fired</b></p></div><br class="figure-break"><div class="figure"><a name="d0e909"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-run-t2-fired.png" alt="Transition t2 fired"></div></div><p class="title"><b>Figure&nbsp;6.7.&nbsp;Transition t2 fired</b></p></div><br class="figure-break"><div class="figure"><a name="d0e918"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MG-run-last.png" alt="Some logical steps later"></div></div><p class="title"><b>Figure&nbsp;6.8.&nbsp;Some logical steps later</b></p></div><br class="figure-break"></div><div class="section" title="6.7.&nbsp;Stop the execution"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_stop_the_execution"></a>6.7.&nbsp;Stop the execution</h2></div></div></div><p>To stop the execution:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Select the "Gemoc Engine Status" view</li><li class="listitem">Select the engine to stop</li><li class="listitem">Click on the red button to actually stop the engine (the left icon
becomes red)</li></ul></div></div></div><div class="chapter" title="Chapter&nbsp;7.&nbsp;Going further&#8230;&#8203;"><div class="titlepage"><div><div><h2 class="title"><a name="_going_further"></a>Chapter&nbsp;7.&nbsp;Going further&#8230;&#8203;</h2></div></div></div><p>To improve readability of the ECL file and also to favor capitalization and
reuse of MoCC elements, it is possible (and encouraged) to define libraries.
Those libraries looks like the predefined ones that we have already used like
kernel.lib and CCSL.lib.</p><div class="section" title="7.1.&nbsp;Define a MoCCML library using CCSL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_define_a_moccml_library_using_ccsl"></a>7.1.&nbsp;Define a MoCCML library using CCSL</h2></div></div></div><p>Using the GEMOC Studio, we start by defining a MoCCML project.  In the xDSML
view, we select <span class="emphasis"><em>Behavioral definition / MoCC definition library</em></span> to create
this new project.</p><p>We can then define in this project the following <a class="link" href="MarkedGraph/markedgraph.ccslLib" target="_top">markedgraph.ccslLib</a> file. TODO: To be corrected.</p><p title="The file markedgraph.ccslLib defining a MoCCML library"><b>The file markedgraph.ccslLib defining a MoCCML library.&nbsp;</b>
</p><pre class="screen">Unresolved directive in GuideTutorialMarkedGraph.asciidoc - include::MarkedGraph/markedgraph.ccslLib[Definition of a MoCCML library]</pre><p title="The file markedgraph.ccslLib defining a MoCCML library">
</p></div><div class="section" title="7.2.&nbsp;Using it in the ECL file"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_it_in_the_ecl_file"></a>7.2.&nbsp;Using it in the ECL file</h2></div></div></div><p>To use this new library, we only have to import it at the beginning of
the ECL file and the we can use it as kernel.lib and CCSL.lib
libraries.</p><p>Here is the new ECL file.</p><p title="The file markedgraph.ecl using the MoCCML library"><b>The file markedgraph.ecl using the MoCCML library.&nbsp;</b>
</p><pre class="screen">import 'platform:/resource/org.gemoc.sample.markedgraph.model/model/markedgraph.ecore'

ECLimport "platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/kernel.ccslLib"
ECLimport "platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/CCSL.ccslLib"
ECLimport "platform:/resource/org.gemoc.sample.markedgraph.mocc/mocc/markedgraph.moccml"

package markedgraph

	context MarkedGraph
		def: initIt: Event = self.initialize()

	context Transition
		def: fireIt: Event = self.fire()

	context Place
		inv placeReadAndWrite:
			let delay: Integer = self.tokenCount in
				Relation placeReadWrite(self.output.fireIt, self.input.fireIt, delay)

	context MarkedGraph
        inv initFirst:
                let firstInit : Event = Expression OneTickAndNoMore(self.initIt) in
                let allFire : Event = Expression Union(self.transitions.fireIt) in
                let firstOfAllFire : Event = Expression OneTickAndNoMore(allFire) in
                Relation Precedes(firstInit, firstOfAllFire)

        inv onlyOneInit:
                let firstInit2 : Event = Expression OneTickAndNoMore(self.initIt) in
                Relation Coincides(self.initIt, firstInit2)

endpackage</pre><p title="The file markedgraph.ecl using the MoCCML library">
</p></div></div><div class="chapter" title="Chapter&nbsp;8.&nbsp;Use constraint automata to define the MoCC"><div class="titlepage"><div><div><h2 class="title"><a name="_use_constraint_automata_to_define_the_mocc"></a>Chapter&nbsp;8.&nbsp;Use constraint automata to define the MoCC</h2></div></div></div><p>Sometimes, it may be easier to define the MoCC using automata.  For
example, we can see a place as something on which we can read a token
(ont output transition reads one token) or we can write a token (one
input transition writes one token).  A token can only be read if there
is at least one in the place.  Initially, there is as much token in
the place as in the initial token count of the place.</p><div class="section" title="8.1.&nbsp;Define the constraint automaton using MoCCML editor"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_define_the_constraint_automaton_using_moccml_editor"></a>8.1.&nbsp;Define the constraint automaton using MoCCML editor</h2></div></div></div><p>For explanations on how to use the MoCCML editor, please refer to the GEMOC
manual.</p><p>We first define the declaration of a relation (placeReadWrite).  Here after
is its graphical representation.  This relation is parameterized by the r clock (some one how wants to read a token), the w clock (someone how wants to write a token, and n the initial count of token in the place).</p><div class="figure"><a name="d0e995"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MoCCML-diagram.png" alt="Graphical definition of a relation"></div></div><p class="title"><b>Figure&nbsp;8.1.&nbsp;Graphical declaration of the placeReadWriteDef relation</b></p></div><br class="figure-break"><p>Then we can define this relation. Here after is the resulting automaton. The
local variable count represent the number of tokens in this place.  s0 is the
initial state. The action on the transition from s0 to s initialize count with
n (the parameter).  The two reflexive transitions on s explain what happens
when w or r occurs.  The write transition is fired when w occurs and  a token is assed in the place (count is incremented). The read transition is fired when r occurs.  It removes a token and thus decrements count.
A guard prevents the read transition to be fired if there is not at liste one token in the place (count &gt;= one).</p><div class="figure"><a name="d0e1006"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/MarkedGraph/MoCCML-automata.png" alt="Automaton defining the placeReadWriteDef relation"></div></div><p class="title"><b>Figure&nbsp;8.2.&nbsp;Automaton defining the placeReadWriteDef relation.</b></p></div><br class="figure-break"><p>Here is the textual representation of this constraint automata.</p><p title="Textual representation of the constraint automata."><b>Textual representation of the constraint automata.&nbsp;</b>
</p><pre class="screen">AutomataConstraintLibrary markedgraph{
	import "platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/kernel.ccslLib" as kernel;
	import "platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/CCSL.ccslLib" as ccsl;

	RelationLibrary placeLib {

		AutomataRelationDefinition placeReadWriteDef[placeReadWrite]{

			variables {
				Integer MAX = 10
				Integer count = 0

			}

			init: s0

			from s0 to s : init
			-&gt; (do count = n.value)

			from s to s : read
			-&gt; ( when r if( count &gt;= one) do count = (count - one))

			from s to s : write
			-&gt; ( when w do count = (count + one))

			State s0 (out : init)
			State s( in : read, write, init
				out : write, read
			)

		}

		RelationDeclaration placeReadWrite(r:clock, w: clock, n: int)
	}
}</pre><p title="Textual representation of the constraint automata.">
</p></div></div></div></div></body></html>